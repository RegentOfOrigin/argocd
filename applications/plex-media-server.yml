apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: plex-media-server
  annotations:
    argocd.argoproj.io/sync-wave: "3"
spec:
  project: default
  syncPolicy:
#    automated: {}
    syncOptions:
      - CreateNamespace=true
      - ApplyOutOfSyncOnly=true
  destination:
    server: https://kubernetes.default.svc
    namespace: plex
  source:
    repoURL: https://raw.githubusercontent.com/plexinc/pms-docker/gh-pages
    chart: plex-media-server
    targetRevision: x
    helm:
      valuesObject:
        pms:
          configExistingClaim: pvc-plex-media-server
        ingress:
          enabled: true
          ingressClassName: nginx
          url: "plex.lexrj.com"
          annotations:
            cert-manager.io/cluster-issuer: cloudflare
        initContainer:
          script: "false"
        nodeSelector:
          lexrj.com/role: nas
        extraVolumes:
          - name: dev-dri
            hostPath:
              path: /dev/dri
              type: Directory
          - name: multimedia
            hostPath:
              path: /tank/multimedia
              type: Directory
        extraVolumeMounts:
          - name: dev-dri
            mountPath: /dev/dri
          - name: multimedia
            mountPath: /multimedia
